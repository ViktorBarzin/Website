<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 700" width="900" height="700" font-family="sans-serif">
  <defs>
    <marker id="arrow-gray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#666666"/>
    </marker>
    <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#4a90d9"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#5cb85c"/>
    </marker>
    <marker id="arrow-orange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#f0ad4e"/>
    </marker>
    <marker id="arrow-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#9c27b0"/>
    </marker>
    <marker id="arrow-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#d9534f"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="28" fill="#1a1a1a" font-size="16" font-weight="bold" text-anchor="middle">Home Lab v3 -- High-Level Architecture</text>

  <!-- Location label -->
  <rect x="700" y="10" width="180" height="28" rx="6" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1.5"/>
  <text x="790" y="29" fill="#6a1b9a" font-size="12" font-weight="bold" text-anchor="middle">Sofia, Bulgaria</text>

  <!-- ========== LEFT PATH: Internet -> ISP -> TP-Link -> pfSense ========== -->

  <!-- Internet Cloud -->
  <ellipse cx="300" cy="65" rx="65" ry="22" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="300" y="70" fill="#333333" font-size="12" text-anchor="middle">Internet</text>

  <!-- Arrow: Internet -> ISP Router -->
  <line x1="300" y1="87" x2="300" y2="105" stroke="#666666" stroke-width="1.5" marker-end="url(#arrow-gray)"/>

  <!-- ISP Router -->
  <rect x="200" y="105" width="200" height="40" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="300" y="121" fill="#333333" font-size="11" font-weight="bold" text-anchor="middle">ISP Router</text>
  <text x="300" y="137" fill="#555555" font-size="9" text-anchor="middle">Public IP: 176.12.22.76</text>

  <!-- Arrow: ISP -> TP-Link -->
  <line x1="300" y1="145" x2="300" y2="163" stroke="#666666" stroke-width="1.5" marker-end="url(#arrow-gray)"/>
  <text x="340" y="157" fill="#888" font-size="8">double NAT</text>

  <!-- TP-Link Router -->
  <rect x="200" y="163" width="200" height="40" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="300" y="179" fill="#333333" font-size="11" font-weight="bold" text-anchor="middle">TP-Link Router</text>
  <text x="300" y="195" fill="#555555" font-size="9" text-anchor="middle">192.168.1.1 -- Home LAN Gateway</text>

  <!-- Arrow: TP-Link -> 192.168.1.0/24 LAN -->
  <line x1="300" y1="203" x2="300" y2="221" stroke="#666666" stroke-width="1.5" marker-end="url(#arrow-gray)"/>

  <!-- 192.168.1.0/24 Home LAN -->
  <rect x="200" y="221" width="200" height="34" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
  <text x="300" y="243" fill="#2c5ea0" font-size="11" font-weight="bold" text-anchor="middle">192.168.1.0/24 Home LAN</text>

  <!-- Arrow: LAN -> pfSense -->
  <line x1="300" y1="255" x2="300" y2="273" stroke="#5cb85c" stroke-width="1.5" marker-end="url(#arrow-green)"/>

  <!-- pfSense -->
  <rect x="200" y="273" width="200" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="2"/>
  <text x="300" y="291" fill="#2d6a2d" font-size="12" font-weight="bold" text-anchor="middle">pfSense Firewall</text>
  <text x="300" y="307" fill="#555555" font-size="9" text-anchor="middle">192.168.1.2 -- Router / NAT / DHCP</text>

  <!-- ========== RIGHT PATH: Cloudflare Tunnel (bypasses ISP/TP-Link) ========== -->

  <!-- Cloudflare -->
  <rect x="570" y="65" width="200" height="44" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
  <text x="670" y="83" fill="#8a6d3b" font-size="11" font-weight="bold" text-anchor="middle">Cloudflare</text>
  <text x="670" y="99" fill="#555555" font-size="9" text-anchor="middle">DNS + Tunnel Proxy</text>

  <!-- Dashed line: Internet -> Cloudflare -->
  <path d="M365,65 L570,83" fill="none" stroke="#f0ad4e" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-orange)"/>

  <!-- Cloudflare Tunnel arrow down to cloudflared pod (in k8s) -->
  <path d="M670,109 L670,460 L590,460" fill="none" stroke="#f0ad4e" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-orange)"/>
  <text x="680" y="280" fill="#8a6d3b" font-size="8" transform="rotate(90,680,280)">Cloudflare Tunnel (bypasses ISP)</text>

  <!-- ========== pfSense branches ========== -->

  <!-- Arrow: pfSense -> VLAN 10 -->
  <line x1="240" y1="317" x2="120" y2="345" stroke="#5cb85c" stroke-width="1.5" marker-end="url(#arrow-green)"/>
  <!-- Arrow: pfSense -> VLAN 20 -->
  <line x1="300" y1="317" x2="300" y2="345" stroke="#4a90d9" stroke-width="1.5" marker-end="url(#arrow-blue)"/>
  <!-- Arrow: pfSense -> VPN -->
  <line x1="360" y1="317" x2="478" y2="345" stroke="#9c27b0" stroke-width="1.5" marker-end="url(#arrow-purple)"/>

  <!-- VLAN 10 Management -->
  <rect x="20" y="345" width="200" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
  <text x="120" y="363" fill="#2d6a2d" font-size="11" font-weight="bold" text-anchor="middle">VLAN 10 -- Management</text>
  <text x="120" y="379" fill="#555555" font-size="9" text-anchor="middle">10.0.10.0/24</text>

  <!-- VLAN 20 Kubernetes -->
  <rect x="235" y="345" width="200" height="44" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
  <text x="335" y="363" fill="#2c5ea0" font-size="11" font-weight="bold" text-anchor="middle">VLAN 20 -- Kubernetes</text>
  <text x="335" y="379" fill="#555555" font-size="9" text-anchor="middle">10.0.20.0/24</text>

  <!-- VPN Tunnels -->
  <rect x="450" y="345" width="200" height="44" rx="6" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1.5"/>
  <text x="550" y="363" fill="#6a1b9a" font-size="11" font-weight="bold" text-anchor="middle">VPN Tunnels</text>
  <text x="550" y="379" fill="#555555" font-size="9" text-anchor="middle">WireGuard + Headscale</text>

  <!-- ========== Proxmox Hypervisor Container ========== -->
  <rect x="20" y="410" width="530" height="120" rx="8" fill="none" stroke="#999999" stroke-width="1.5" stroke-dasharray="6,3"/>
  <text x="285" y="428" fill="#555555" font-size="12" font-weight="bold" text-anchor="middle">Proxmox Hypervisor (192.168.1.127)</text>

  <!-- VMs inside Proxmox -->
  <!-- k8s cluster -->
  <rect x="35" y="438" width="120" height="40" rx="5" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1"/>
  <text x="95" y="454" fill="#2c5ea0" font-size="9" font-weight="bold" text-anchor="middle">k8s-master</text>
  <text x="95" y="470" fill="#555555" font-size="8" text-anchor="middle">+ 4 worker nodes</text>

  <!-- k8s-node1 GPU -->
  <rect x="170" y="438" width="120" height="40" rx="5" fill="#fce4ec" stroke="#d9534f" stroke-width="1.5"/>
  <text x="230" y="454" fill="#a94442" font-size="9" font-weight="bold" text-anchor="middle">k8s-node1 (GPU)</text>
  <text x="230" y="470" fill="#555555" font-size="8" text-anchor="middle">RTX 3060</text>

  <!-- cloudflared pod label -->
  <rect x="470" y="444" width="70" height="30" rx="4" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1"/>
  <text x="505" y="463" fill="#8a6d3b" font-size="8" font-weight="bold" text-anchor="middle">cloudflared</text>

  <!-- pfSense VM -->
  <rect x="35" y="486" width="120" height="36" rx="5" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="95" y="500" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">pfSense VM</text>
  <text x="95" y="514" fill="#555555" font-size="8" text-anchor="middle">VMID 101</text>

  <!-- ha-sofia VM -->
  <rect x="170" y="486" width="120" height="36" rx="5" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="230" y="500" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">ha-sofia</text>
  <text x="230" y="514" fill="#555555" font-size="8" text-anchor="middle">VMID 103</text>

  <!-- TrueNAS VM -->
  <rect x="305" y="486" width="120" height="36" rx="5" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="365" y="500" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">TrueNAS</text>
  <text x="365" y="514" fill="#555555" font-size="8" text-anchor="middle">NFS / ZFS</text>

  <!-- devvm + others -->
  <rect x="305" y="438" width="120" height="40" rx="5" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="365" y="454" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">devvm, registry</text>
  <text x="365" y="470" fill="#555555" font-size="8" text-anchor="middle">Win10, etc.</text>

  <!-- ========== WireGuard to London ========== -->
  <rect x="20" y="555" width="220" height="50" rx="6" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1.5"/>
  <text x="130" y="573" fill="#6a1b9a" font-size="10" font-weight="bold" text-anchor="middle">London -- Raspberry Pi</text>
  <text x="130" y="590" fill="#555555" font-size="9" text-anchor="middle">HA London (WireGuard 10.3.2.6)</text>

  <!-- Arrow: VPN -> London -->
  <path d="M550,389 L550,575 L240,575" fill="none" stroke="#9c27b0" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arrow-purple)"/>
  <text x="558" y="490" fill="#6a1b9a" font-size="8" transform="rotate(90,558,490)">WireGuard tunnel</text>

  <!-- ========== Power Path (bottom) ========== -->
  <rect x="20" y="630" width="860" height="50" rx="6" fill="none" stroke="#999999" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="450" y="647" fill="#555555" font-size="10" font-weight="bold" text-anchor="middle">Power Path (Sofia)</text>

  <!-- Solar -->
  <rect x="35" y="652" width="100" height="22" rx="4" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1"/>
  <text x="85" y="667" fill="#8a6d3b" font-size="9" text-anchor="middle">Solar Panels</text>

  <text x="145" y="667" fill="#666" font-size="10">--></text>

  <!-- Inverter -->
  <rect x="170" y="652" width="90" height="22" rx="4" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1"/>
  <text x="215" y="667" fill="#8a6d3b" font-size="9" text-anchor="middle">Inverter</text>

  <text x="270" y="667" fill="#666" font-size="10">--></text>

  <!-- ATS -->
  <rect x="295" y="652" width="80" height="22" rx="4" fill="#f5f5f5" stroke="#999999" stroke-width="1"/>
  <text x="335" y="667" fill="#333" font-size="9" text-anchor="middle">ATS</text>

  <text x="385" y="667" fill="#666" font-size="10">--></text>

  <!-- UPS -->
  <rect x="410" y="652" width="80" height="22" rx="4" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="450" y="667" fill="#2d6a2d" font-size="9" text-anchor="middle">UPS</text>

  <text x="500" y="667" fill="#666" font-size="10">--></text>

  <!-- Server -->
  <rect x="525" y="652" width="160" height="22" rx="4" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1"/>
  <text x="605" y="667" fill="#2c5ea0" font-size="9" text-anchor="middle">Dell R7525 Server</text>

  <!-- Legend -->
  <rect x="30" y="687" width="10" height="10" rx="2" fill="#4a90d9"/>
  <text x="46" y="696" fill="#333333" font-size="8">Kubernetes</text>
  <rect x="120" y="687" width="10" height="10" rx="2" fill="#5cb85c"/>
  <text x="136" y="696" fill="#333333" font-size="8">Infrastructure</text>
  <rect x="220" y="687" width="10" height="10" rx="2" fill="#f0ad4e"/>
  <text x="236" y="696" fill="#333333" font-size="8">Cloudflare / Power</text>
  <rect x="340" y="687" width="10" height="10" rx="2" fill="#9c27b0"/>
  <text x="356" y="696" fill="#333333" font-size="8">VPN Tunnels</text>
  <rect x="440" y="687" width="10" height="10" rx="2" fill="#d9534f"/>
  <text x="456" y="696" fill="#333333" font-size="8">GPU Node</text>
  <rect x="530" y="687" width="10" height="10" rx="2" fill="#999999"/>
  <text x="546" y="696" fill="#333333" font-size="8">General / LAN</text>
</svg>