<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 620" width="900" height="620" font-family="sans-serif">
  <defs>
    <marker id="arrow-gray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#666666"/>
    </marker>
    <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#4a90d9"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#5cb85c"/>
    </marker>
    <marker id="arrow-orange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#f0ad4e"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="30" fill="#1a1a1a" font-size="16" font-weight="bold" text-anchor="middle">Home Lab v3 -- High-Level Architecture</text>

  <!-- Internet Cloud -->
  <g data-label="Internet">
    <title>Internet - External connectivity</title>
    <ellipse cx="450" cy="65" rx="70" ry="22" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
    <text x="450" y="70" fill="#333333" font-size="12" text-anchor="middle">Internet</text>
  </g>

  <!-- Cloudflare -->
  <g data-label="Cloudflare">
    <title>Cloudflare - DNS and Tunnel proxy</title>
    <rect x="370" y="100" width="160" height="36" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
    <text x="450" y="122" fill="#8a6d3b" font-size="11" font-weight="bold" text-anchor="middle">Cloudflare (DNS + Tunnel)</text>
  </g>

  <!-- Arrow: Internet -> Cloudflare -->
  <line x1="450" y1="87" x2="450" y2="100" stroke="#666666" stroke-width="1.5" marker-end="url(#arrow-gray)"/>

  <!-- pfSense -->
  <g data-label="pfSense">
    <title>pfSense - Firewall and router</title>
    <rect x="370" y="155" width="160" height="36" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="450" y="177" fill="#2d6a2d" font-size="11" font-weight="bold" text-anchor="middle">pfSense Firewall</text>
  </g>

  <!-- Arrow: Cloudflare -> pfSense -->
  <line x1="450" y1="136" x2="450" y2="155" stroke="#666666" stroke-width="1.5" marker-end="url(#arrow-gray)"/>

  <!-- Home VLAN -->
  <g data-label="Home Network">
    <title>Home Network - 192.168.1.0/24 (untagged)</title>
    <rect x="20" y="215" width="240" height="50" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
    <text x="140" y="236" fill="#2c5ea0" font-size="11" font-weight="bold" text-anchor="middle">Home Network</text>
    <text x="140" y="252" fill="#555555" font-size="10" text-anchor="middle">192.168.1.0/24</text>
  </g>

  <!-- Management VLAN -->
  <g data-label="Management VLAN">
    <title>VLAN 10 - Management network 10.0.10.0/24</title>
    <rect x="330" y="215" width="240" height="50" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="450" y="236" fill="#2d6a2d" font-size="11" font-weight="bold" text-anchor="middle">VLAN 10 -- Management</text>
    <text x="450" y="252" fill="#555555" font-size="10" text-anchor="middle">10.0.10.0/24</text>
  </g>

  <!-- Kubernetes VLAN -->
  <g data-label="Kubernetes VLAN">
    <title>VLAN 20 - Kubernetes network 10.0.20.0/24</title>
    <rect x="640" y="215" width="240" height="50" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
    <text x="760" y="236" fill="#8a6d3b" font-size="11" font-weight="bold" text-anchor="middle">VLAN 20 -- Kubernetes</text>
    <text x="760" y="252" fill="#555555" font-size="10" text-anchor="middle">10.0.20.0/24</text>
  </g>

  <!-- Arrows pfSense -> VLANs -->
  <line x1="410" y1="191" x2="140" y2="215" stroke="#4a90d9" stroke-width="1.5" marker-end="url(#arrow-blue)"/>
  <line x1="450" y1="191" x2="450" y2="215" stroke="#5cb85c" stroke-width="1.5" marker-end="url(#arrow-green)"/>
  <line x1="490" y1="191" x2="760" y2="215" stroke="#f0ad4e" stroke-width="1.5" marker-end="url(#arrow-orange)"/>

  <!-- Proxmox Box -->
  <g data-label="Proxmox Hypervisor">
    <title>Proxmox VE Hypervisor at 192.168.1.200</title>
    <rect x="80" y="295" width="740" height="230" rx="8" fill="none" stroke="#999999" stroke-width="1.5" stroke-dasharray="6,3"/>
    <text x="450" y="315" fill="#555555" font-size="13" font-weight="bold" text-anchor="middle">Proxmox Hypervisor (192.168.1.200)</text>
  </g>

  <!-- k8s-master -->
  <g data-label="k8s-master">
    <title>k8s-master - Kubernetes control plane (8 CPU / 16G RAM)</title>
    <rect x="110" y="330" width="140" height="44" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
    <text x="180" y="349" fill="#2c5ea0" font-size="10" font-weight="bold" text-anchor="middle">k8s-master</text>
    <text x="180" y="365" fill="#555555" font-size="9" text-anchor="middle">8C / 16G</text>
  </g>

  <!-- k8s-node1 (GPU) -->
  <g data-label="k8s-node1 GPU">
    <title>k8s-node1 - GPU worker node with RTX 3060 (16 CPU / 24G RAM)</title>
    <rect x="270" y="330" width="160" height="44" rx="6" fill="#fce4ec" stroke="#d9534f" stroke-width="2"/>
    <text x="350" y="349" fill="#a94442" font-size="10" font-weight="bold" text-anchor="middle">k8s-node1 (GPU)</text>
    <text x="350" y="365" fill="#555555" font-size="9" text-anchor="middle">16C / 24G + RTX 3060</text>
  </g>

  <!-- k8s-node2-4 -->
  <g data-label="k8s-node2-4">
    <title>k8s-node2-4 - Kubernetes worker nodes (3x 8 CPU / 16G RAM)</title>
    <rect x="450" y="330" width="140" height="44" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
    <text x="520" y="349" fill="#2c5ea0" font-size="10" font-weight="bold" text-anchor="middle">k8s-node2-4</text>
    <text x="520" y="365" fill="#555555" font-size="9" text-anchor="middle">3x 8C / 16G</text>
  </g>

  <!-- TrueNAS -->
  <g data-label="TrueNAS">
    <title>TrueNAS - NFS and ZFS storage (16 CPU / 16G RAM)</title>
    <rect x="610" y="330" width="140" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="680" y="349" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">TrueNAS</text>
    <text x="680" y="365" fill="#555555" font-size="9" text-anchor="middle">16C / 16G / NFS</text>
  </g>

  <!-- devvm -->
  <g data-label="devvm">
    <title>devvm - Development VM (16 CPU / 8G RAM)</title>
    <rect x="110" y="395" width="140" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="180" y="414" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">devvm</text>
    <text x="180" y="430" fill="#555555" font-size="9" text-anchor="middle">16C / 8G</text>
  </g>

  <!-- Home Assistant -->
  <g data-label="Home Assistant">
    <title>Home Assistant - Smart home automation (8 CPU / 16G RAM)</title>
    <rect x="270" y="395" width="160" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="350" y="414" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">Home Assistant</text>
    <text x="350" y="430" fill="#555555" font-size="9" text-anchor="middle">8C / 16G</text>
  </g>

  <!-- Docker Registry -->
  <g data-label="docker-registry">
    <title>docker-registry - Container image storage (4 CPU / 4G RAM)</title>
    <rect x="450" y="395" width="140" height="44" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
    <text x="520" y="414" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">docker-registry</text>
    <text x="520" y="430" fill="#555555" font-size="9" text-anchor="middle">4C / 4G</text>
  </g>

  <!-- Windows 10 -->
  <g data-label="Windows 10">
    <title>Windows 10 - General purpose VM (16 CPU / 8G RAM)</title>
    <rect x="610" y="395" width="140" height="44" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
    <text x="680" y="414" fill="#333333" font-size="10" font-weight="bold" text-anchor="middle">Windows 10</text>
    <text x="680" y="430" fill="#555555" font-size="9" text-anchor="middle">16C / 8G</text>
  </g>

  <!-- VPN Tunnels -->
  <g data-label="WireGuard VPN">
    <title>WireGuard VPN - Site-to-site and roaming tunnels</title>
    <rect x="110" y="460" width="160" height="44" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
    <text x="190" y="479" fill="#8a6d3b" font-size="10" font-weight="bold" text-anchor="middle">WireGuard VPN</text>
    <text x="190" y="495" fill="#555555" font-size="9" text-anchor="middle">Site-to-Site + Roaming</text>
  </g>

  <g data-label="Headscale">
    <title>Headscale - Tailscale-compatible mesh VPN overlay</title>
    <rect x="290" y="460" width="160" height="44" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
    <text x="370" y="479" fill="#8a6d3b" font-size="10" font-weight="bold" text-anchor="middle">Headscale (Tailscale)</text>
    <text x="370" y="495" fill="#555555" font-size="9" text-anchor="middle">Mesh VPN Overlay</text>
  </g>

  <!-- HA Sofia Remote Site -->
  <g data-label="HA Sofia">
    <title>HA Sofia - Remote Home Assistant site connected via WireGuard</title>
    <rect x="640" y="555" width="200" height="44" rx="6" fill="#fce4ec" stroke="#d9534f" stroke-width="1.5"/>
    <text x="740" y="574" fill="#a94442" font-size="10" font-weight="bold" text-anchor="middle">HA Sofia -- Remote Site</text>
    <text x="740" y="590" fill="#555555" font-size="9" text-anchor="middle">Home Assistant (WireGuard)</text>
  </g>

  <!-- Arrow: VPN -> Remote Site -->
  <path d="M270,504 L270,577 L640,577" fill="none" stroke="#f0ad4e" stroke-width="1.5" marker-end="url(#arrow-orange)" stroke-dasharray="5,3"/>

  <!-- Legend -->
  <rect x="20" y="555" width="12" height="12" rx="2" fill="#4a90d9"/>
  <text x="38" y="565" fill="#333333" font-size="9">Kubernetes</text>
  <rect x="110" y="555" width="12" height="12" rx="2" fill="#5cb85c"/>
  <text x="128" y="565" fill="#333333" font-size="9">Infrastructure</text>
  <rect x="215" y="555" width="12" height="12" rx="2" fill="#d9534f"/>
  <text x="233" y="565" fill="#333333" font-size="9">GPU / Remote</text>
  <rect x="315" y="555" width="12" height="12" rx="2" fill="#f0ad4e"/>
  <text x="333" y="565" fill="#333333" font-size="9">VPN Tunnels</text>
</svg>