<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 620" width="900" height="620" font-family="sans-serif">
  <defs>
    <marker id="a-gray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#666666"/>
    </marker>
    <marker id="a-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#4a90d9"/>
    </marker>
    <marker id="a-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#5cb85c"/>
    </marker>
    <marker id="a-orange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#f0ad4e"/>
    </marker>
    <marker id="a-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#9c27b0"/>
    </marker>
    <marker id="a-red" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#d9534f"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="450" y="25" fill="#1a1a1a" font-size="16" font-weight="bold" text-anchor="middle">Network Topology</text>

  <!-- ========== TOP: Internet -> ISP -> TP-Link -> Physical LAN ========== -->

  <!-- Internet -->
  <ellipse cx="310" cy="55" rx="55" ry="18" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="310" y="60" fill="#333333" font-size="11" text-anchor="middle">Internet</text>

  <!-- Arrow: Internet -> ISP Router -->
  <line x1="310" y1="73" x2="310" y2="88" stroke="#666666" stroke-width="1.5" marker-end="url(#a-gray)"/>

  <!-- ISP Router -->
  <rect x="220" y="88" width="180" height="34" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="310" y="101" fill="#333333" font-size="10" font-weight="bold" text-anchor="middle">ISP Router</text>
  <text x="310" y="115" fill="#555555" font-size="9" text-anchor="middle">Public: 176.12.22.76</text>

  <!-- Arrow: ISP -> TP-Link -->
  <line x1="310" y1="122" x2="310" y2="137" stroke="#666666" stroke-width="1.5" marker-end="url(#a-gray)"/>

  <!-- TP-Link Router -->
  <rect x="220" y="137" width="180" height="34" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1.5"/>
  <text x="310" y="150" fill="#333333" font-size="10" font-weight="bold" text-anchor="middle">TP-Link Router (NAT)</text>
  <text x="310" y="164" fill="#555555" font-size="9" text-anchor="middle">192.168.1.1</text>

  <!-- Arrow: TP-Link -> Physical LAN -->
  <line x1="310" y1="171" x2="310" y2="186" stroke="#666666" stroke-width="1.5" marker-end="url(#a-gray)"/>

  <!-- 192.168.1.0/24 Physical LAN bar -->
  <rect x="30" y="186" width="560" height="32" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
  <text x="310" y="207" fill="#2c5ea0" font-size="11" font-weight="bold" text-anchor="middle">192.168.1.0/24 -- Physical LAN</text>

  <!-- ========== Devices on Physical LAN ========== -->

  <!-- Proxmox Host -->
  <rect x="30" y="233" width="140" height="55" rx="6" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1"/>
  <text x="100" y="251" fill="#2c5ea0" font-size="10" font-weight="bold" text-anchor="middle">Proxmox Host</text>
  <text x="100" y="265" fill="#555555" font-size="9" text-anchor="middle">192.168.1.127</text>
  <text x="100" y="279" fill="#555555" font-size="8" text-anchor="middle">Dell R7525</text>
  <line x1="100" y1="218" x2="100" y2="233" stroke="#4a90d9" stroke-width="1" marker-end="url(#a-blue)"/>

  <!-- Bridges under Proxmox -->
  <rect x="30" y="303" width="60" height="28" rx="4" fill="#f5f5f5" stroke="#999999" stroke-width="1"/>
  <text x="60" y="316" fill="#333333" font-size="8" font-weight="bold" text-anchor="middle">vmbr0</text>
  <text x="60" y="326" fill="#555555" font-size="7" text-anchor="middle">physical</text>
  <line x1="70" y1="288" x2="60" y2="303" stroke="#666666" stroke-width="1" marker-end="url(#a-gray)"/>

  <rect x="105" y="303" width="65" height="28" rx="4" fill="#f5f5f5" stroke="#999999" stroke-width="1"/>
  <text x="137" y="316" fill="#333333" font-size="8" font-weight="bold" text-anchor="middle">vmbr1</text>
  <text x="137" y="326" fill="#555555" font-size="7" text-anchor="middle">VLAN trunk</text>
  <line x1="130" y1="288" x2="137" y2="303" stroke="#666666" stroke-width="1" marker-end="url(#a-gray)"/>

  <!-- pfSense WAN -->
  <rect x="190" y="233" width="130" height="45" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
  <text x="255" y="251" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">pfSense (WAN)</text>
  <text x="255" y="265" fill="#555555" font-size="9" text-anchor="middle">192.168.1.2</text>
  <line x1="255" y1="218" x2="255" y2="233" stroke="#5cb85c" stroke-width="1" marker-end="url(#a-green)"/>

  <!-- iDRAC -->
  <rect x="340" y="233" width="110" height="45" rx="6" fill="#f5f5f5" stroke="#999999" stroke-width="1"/>
  <text x="395" y="251" fill="#333333" font-size="10" font-weight="bold" text-anchor="middle">iDRAC</text>
  <text x="395" y="265" fill="#555555" font-size="9" text-anchor="middle">192.168.1.4</text>
  <line x1="395" y1="218" x2="395" y2="233" stroke="#666666" stroke-width="1" marker-end="url(#a-gray)"/>

  <!-- ha-sofia on vmbr0 -->
  <rect x="470" y="233" width="120" height="45" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="530" y="251" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">ha-sofia VM</text>
  <text x="530" y="265" fill="#555555" font-size="9" text-anchor="middle">on vmbr0</text>
  <line x1="530" y1="218" x2="530" y2="233" stroke="#5cb85c" stroke-width="1" marker-end="url(#a-green)"/>

  <!-- ========== pfSense Internal Interfaces ========== -->

  <!-- pfSense central box -->
  <rect x="180" y="300" width="150" height="40" rx="6" fill="#e6f4ea" stroke="#5cb85c" stroke-width="2"/>
  <text x="255" y="317" fill="#2d6a2d" font-size="11" font-weight="bold" text-anchor="middle">pfSense Interfaces</text>
  <text x="255" y="332" fill="#555555" font-size="8" text-anchor="middle">LAN / OPT1 / WireGuard</text>

  <!-- Arrow from pfSense WAN down to pfSense interfaces -->
  <line x1="255" y1="278" x2="255" y2="300" stroke="#5cb85c" stroke-width="1.5" marker-end="url(#a-green)"/>

  <!-- ===== LAN interface: 10.0.10.0/24 (left) ===== -->
  <line x1="210" y1="340" x2="100" y2="362" stroke="#5cb85c" stroke-width="1.5" marker-end="url(#a-green)"/>
  <text x="140" y="350" fill="#2d6a2d" font-size="8">LAN</text>

  <rect x="20" y="362" width="180" height="30" rx="5" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1.5"/>
  <text x="110" y="382" fill="#2d6a2d" font-size="10" font-weight="bold" text-anchor="middle">LAN -- 10.0.10.0/24</text>

  <!-- Devices on LAN -->
  <rect x="20" y="407" width="80" height="38" rx="4" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="60" y="422" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">TrueNAS</text>
  <text x="60" y="436" fill="#555555" font-size="8" text-anchor="middle">.15</text>
  <line x1="60" y1="392" x2="60" y2="407" stroke="#5cb85c" stroke-width="1" marker-end="url(#a-green)"/>

  <rect x="115" y="407" width="80" height="38" rx="4" fill="#e6f4ea" stroke="#5cb85c" stroke-width="1"/>
  <text x="155" y="422" fill="#2d6a2d" font-size="9" font-weight="bold" text-anchor="middle">devvm</text>
  <text x="155" y="436" fill="#555555" font-size="8" text-anchor="middle">.10</text>
  <line x1="155" y1="392" x2="155" y2="407" stroke="#5cb85c" stroke-width="1" marker-end="url(#a-green)"/>

  <!-- ===== OPT1 interface: 10.0.20.0/24 (center-right) ===== -->
  <line x1="300" y1="340" x2="470" y2="362" stroke="#4a90d9" stroke-width="1.5" marker-end="url(#a-blue)"/>
  <text x="400" y="350" fill="#2c5ea0" font-size="8">OPT1</text>

  <rect x="380" y="362" width="220" height="30" rx="5" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1.5"/>
  <text x="490" y="382" fill="#2c5ea0" font-size="10" font-weight="bold" text-anchor="middle">OPT1 -- 10.0.20.0/24 (K8s)</text>

  <!-- Devices on OPT1/K8s VLAN -->
  <rect x="380" y="407" width="80" height="48" rx="4" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1"/>
  <text x="420" y="422" fill="#2c5ea0" font-size="8" font-weight="bold" text-anchor="middle">k8s-master</text>
  <text x="420" y="434" fill="#555555" font-size="8" text-anchor="middle">.100</text>
  <text x="420" y="448" fill="#555555" font-size="7" text-anchor="middle">DNS: .101</text>
  <line x1="420" y1="392" x2="420" y2="407" stroke="#4a90d9" stroke-width="1" marker-end="url(#a-blue)"/>

  <rect x="475" y="407" width="80" height="48" rx="4" fill="#e8f0fe" stroke="#4a90d9" stroke-width="1"/>
  <text x="515" y="422" fill="#2c5ea0" font-size="8" font-weight="bold" text-anchor="middle">k8s-nodes</text>
  <text x="515" y="434" fill="#555555" font-size="8" text-anchor="middle">1-4</text>
  <text x="515" y="448" fill="#555555" font-size="7" text-anchor="middle">Registry: .10</text>
  <line x1="515" y1="392" x2="515" y2="407" stroke="#4a90d9" stroke-width="1" marker-end="url(#a-blue)"/>

  <!-- MetalLB Pool -->
  <rect x="380" y="470" width="100" height="38" rx="4" fill="#fce4ec" stroke="#d9534f" stroke-width="1.5"/>
  <text x="430" y="485" fill="#a94442" font-size="8" font-weight="bold" text-anchor="middle">MetalLB Pool</text>
  <text x="430" y="499" fill="#555555" font-size="7" text-anchor="middle">.200-.220</text>
  <line x1="430" y1="455" x2="430" y2="470" stroke="#d9534f" stroke-width="1" marker-end="url(#a-red)"/>

  <!-- Traefik -->
  <rect x="495" y="470" width="100" height="38" rx="4" fill="#fce4ec" stroke="#d9534f" stroke-width="1"/>
  <text x="545" y="485" fill="#a94442" font-size="8" font-weight="bold" text-anchor="middle">Traefik</text>
  <text x="545" y="499" fill="#555555" font-size="7" text-anchor="middle">10.0.20.202</text>
  <line x1="530" y1="455" x2="540" y2="470" stroke="#d9534f" stroke-width="1" marker-end="url(#a-red)"/>

  <!-- ===== WireGuard interface ===== -->
  <line x1="255" y1="340" x2="255" y2="362" stroke="#9c27b0" stroke-width="1.5" marker-end="url(#a-purple)"/>

  <rect x="210" y="362" width="155" height="30" rx="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1.5"/>
  <text x="287" y="382" fill="#6a1b9a" font-size="10" font-weight="bold" text-anchor="middle">WireGuard 10.3.0.0/16</text>

  <!-- London RPi -->
  <rect x="210" y="407" width="155" height="42" rx="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="1"/>
  <text x="287" y="424" fill="#6a1b9a" font-size="9" font-weight="bold" text-anchor="middle">London Raspberry Pi</text>
  <text x="287" y="440" fill="#555555" font-size="8" text-anchor="middle">HA London -- 10.3.2.6</text>
  <line x1="287" y1="392" x2="287" y2="407" stroke="#9c27b0" stroke-width="1" marker-end="url(#a-purple)"/>

  <!-- ========== Cloudflare Tunnel (separate path) ========== -->

  <!-- Cloudflare box -->
  <rect x="680" y="48" width="190" height="40" rx="6" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1.5"/>
  <text x="775" y="64" fill="#8a6d3b" font-size="10" font-weight="bold" text-anchor="middle">Cloudflare</text>
  <text x="775" y="79" fill="#555555" font-size="9" text-anchor="middle">DNS + Tunnel Proxy</text>

  <!-- Dashed line from Internet to Cloudflare -->
  <path d="M365,55 L680,62" fill="none" stroke="#f0ad4e" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#a-orange)"/>

  <!-- cloudflared pod -->
  <rect x="700" y="120" width="150" height="36" rx="5" fill="#fff3e0" stroke="#f0ad4e" stroke-width="1"/>
  <text x="775" y="136" fill="#8a6d3b" font-size="9" font-weight="bold" text-anchor="middle">cloudflared pod</text>
  <text x="775" y="150" fill="#555555" font-size="8" text-anchor="middle">(in k8s cluster)</text>

  <!-- Arrow: Cloudflare -> cloudflared -->
  <line x1="775" y1="88" x2="775" y2="120" stroke="#f0ad4e" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#a-orange)"/>

  <!-- Arrow: cloudflared -> Traefik -->
  <path d="M775,156 L775,490 L595,490" fill="none" stroke="#f0ad4e" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#a-orange)"/>
  <text x="730" y="280" fill="#8a6d3b" font-size="8" transform="rotate(90,730,280)">Tunnel (bypasses NAT)</text>

  <!-- ========== Legend ========== -->
  <rect x="70" y="540" width="12" height="12" rx="2" fill="#4a90d9"/>
  <text x="88" y="550" fill="#333333" font-size="9">Physical LAN</text>
  <rect x="180" y="540" width="12" height="12" rx="2" fill="#5cb85c"/>
  <text x="198" y="550" fill="#333333" font-size="9">VLAN 10 (Mgmt)</text>
  <rect x="300" y="540" width="12" height="12" rx="2" fill="#4a90d9"/>
  <text x="318" y="550" fill="#333333" font-size="9">VLAN 20 (K8s)</text>
  <rect x="420" y="540" width="12" height="12" rx="2" fill="#9c27b0"/>
  <text x="438" y="550" fill="#333333" font-size="9">WireGuard VPN</text>
  <rect x="540" y="540" width="12" height="12" rx="2" fill="#d9534f"/>
  <text x="558" y="550" fill="#333333" font-size="9">MetalLB / Traefik</text>
  <rect x="670" y="540" width="12" height="12" rx="2" fill="#f0ad4e"/>
  <text x="688" y="550" fill="#333333" font-size="9">Cloudflare Tunnel</text>

  <!-- Note about topology -->
  <text x="450" y="580" fill="#888888" font-size="8" text-anchor="middle">Double NAT: Internet -> ISP Router (176.12.22.76) -> TP-Link (192.168.1.1) -> pfSense (192.168.1.2) -> VLANs</text>
  <text x="450" y="595" fill="#888888" font-size="8" text-anchor="middle">Cloudflare Tunnel bypasses NAT entirely -- connects directly to cloudflared pod in Kubernetes</text>
</svg>